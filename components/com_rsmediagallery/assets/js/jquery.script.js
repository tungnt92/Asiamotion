function rsmg_init_load_more(a){if(a("#rsmg_load_more").length>0){var b=a("#rsmg_load_more").attr("rel");var c=0;if(b>0)c=b-a("ul#rsmg_gallery").children().length;if(c<0)c=0;a("#rsmg_load_more").attr("rel",c);a("#rsmg_load_more").html(rsmg_get_lang("RSMG_LOAD_MORE").replace("%d",a("#rsmg_load_more").attr("rel")));a("#rsmg_load_more").click(function(b){b.preventDefault();b.shiftKey?rsmg_get_items(a,false,{limitall:1,limit:a("#rsmg_load_more").attr("rel")}):rsmg_get_items(a)});a(document).keydown(function(b){if(b.shiftKey)a("#rsmg_load_more").html(rsmg_get_lang("RSMG_LOAD_ALL").replace("%d",a("#rsmg_load_more").attr("rel")))});a(document).keyup(function(b){a("#rsmg_load_more").html(rsmg_get_lang("RSMG_LOAD_MORE").replace("%d",a("#rsmg_load_more").attr("rel")))})}}function rsmg_init_items(a){a("#rsmg_gallery li img").hover(function(){a(this).stop().animate({opacity:.7},"slow")},function(){a(this).stop().animate({opacity:1},"slow")});if(typeof window.rsmg_slideshow!="undefined"&&window.rsmg_slideshow==1){a("#rsmg_gallery li img").unbind("click");a("#rsmg_gallery li img").each(function(b,c){a(c).click(function(c){c.preventDefault();a(this).rsmg_lightbox({currentIndex:b})})})}}function rsmg_get_items(a,b,c,d){var e=a("#rsmg_gallery");if(b==true)e.empty();a.ajax({type:"POST",url:"index.php?option=com_rsmediagallery&task=getitems&format=raw",data:rsmg_get_items_filter(a,c),beforeSend:function(){var b=a("<li>",{id:"rsmg_loader_container"});var c=a("<div>",{"class":"rsmg_item_container"});b.append(c);e.append(b);a("#rsmg_load_more").hide("fade",500)},success:function(b){a("#rsmg_loader_container").remove();if(typeof b=="object"&&b.items&&b.total){a(b.items).each(function(b,c){var d=a("<li>");var f=a("<div>",{"class":"rsmg_item_container"});var g=a("<a>",{href:c.href});var h=a("<img>",{src:c.thumb,alt:c.title});g.append(h);var i="";if(typeof c.title!="undefined")i=a("<a>",{href:c.href,"class":"rsmsg_title"}).html(c.title);var j="";if(typeof c.description!="undefined")j=a("<span>",{"class":"rsmg_item_description"}).html(c.description);d.append(f.append(g,i,j));e.append(d)});rsmg_init_items(a);if(b.total>a("ul#rsmg_gallery").children().length){var c=b.total-a("ul#rsmg_gallery").children().length;a("#rsmg_load_more").html(rsmg_get_lang("RSMG_LOAD_MORE").replace("%d",c));a("#rsmg_load_more").attr("rel",c);a("#rsmg_load_more").show("fade",500)}else a("#rsmg_load_more").attr("rel",0);if(typeof d=="function"){d(b)}}}})}function rsmg_get_items_filter(a,b){var c={limitstart:a("ul#rsmg_gallery").children().length,Itemid:a("#rsmg_itemid").val()};if(b)for(var d in b)c[d]=b[d];return c}jQuery(document).ready(function(a){if(a("#rsmg_prev_page").length>0)a("#rsmg_prev_page").hide();rsmg_init_load_more(a);rsmg_init_items(a);var b=window.location!=window.parent.location;var c=a("#rsmg_image_container img").attr("src");if(a.browser.msie&&a.browser.version<9){c+=c.indexOf("?")==-1?"?":"&";c+="random="+Math.floor(Math.random()*11e3)}var d=a("<img>",{src:c}).load(function(){if(b){var c=a("#rsmg_main").outerWidth()+110;var d=a("#rsmg_main").outerHeight();if(c>a(window).width()){var e=Math.round(a(window).width()/2);c=e+125;a("#rsmg_thumb_container img").css("width",e+"px");a("#rsmg_main").css("width",e+22+"px")}a(window.parent.document.getElementById("rsmg_iframe")).css({width:c,height:d});var f=a(window.parent.document).find("#rsmg_iframe").height();var g=a(window.parent).height();var h=a(window.parent.document).height();if(f+80>g){var i=a(window.parent.document).scrollTop()+40;if(i+f>g)window.parent.scrollTo(0,0)}}else{if(a("#rsmg_thumb_container > img").outerWidth()>a("#rsmg_main").parent().outerWidth())a("#rsmg_image_container img").css("width","100%")}a("#rsmg_image_container img").show("blind",500)});if(b){var e=window.parent.document;if(typeof window.parent.rsmg_set_self_position=="function")window.parent.rsmg_set_self_position();var f=window.parent.rsmg_lightbox_index;var g=a(e).find("#rsmg_gallery li img").length;var h=g;if(typeof a(e).find("#rsmg_load_more").attr("rel")!="undefined")g+=parseInt(a(e).find("#rsmg_load_more").attr("rel"));var i=a("#rsmg_arrow_left a");var j=a("#rsmg_arrow_right a");if(f==0)i.hide();if(g<2||f+1>=g)j.hide();i.unbind("click");i.click(function(b){b.preventDefault();var c=f-1;window.parent.jQuery(a(e).find("#rsmg_gallery li img")[c]).rsmg_lightbox({currentIndex:c})});j.unbind("click");j.click(function(b){b.preventDefault();var c=f+1;if(c>=h){if(typeof window.parent.rsmg_get_items=="function"){window.parent.rsmg_get_items(window.parent.jQuery,false,false,function(b){window.parent.jQuery(a(e).find("#rsmg_gallery li img")[c]).rsmg_lightbox({currentIndex:c})})}return}window.parent.jQuery(a(e).find("#rsmg_gallery li img")[c]).rsmg_lightbox({currentIndex:c})});a(window).keyup(function(a){if((a.keyCode==27||a.DOM_VK_ESCAPE==27&&a.which==0)&&typeof window.parent.rsmg_close_lightbox=="function")window.parent.rsmg_close_lightbox();if(a.keyCode==37)i.click();if(a.keyCode==39)j.click()});a("#rsmg_component_main").click(function(b){if(a(b.target).length>0&&a(b.target).attr("id")==a(this).attr("id"))if(typeof window.parent.rsmg_close_lightbox=="function")window.parent.rsmg_close_lightbox()})}})